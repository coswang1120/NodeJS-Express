#第02課 產品資料清單


## 產品資料清單-不分頁


###執行網址:
```
完成所有步驟後, 在瀏覽器中輸入以下網址:
http://localhost:3000/productList 
```



###執行圖示如下:<p>
![GitHub Logo](/images/f02_1.png)



###執行環境:
```
(1) 以「第00課 安裝Node.js及Express」的說明建立一個web網站
(2) 安裝MySQL套件
    npm install mysql
(3) 建立一個mysql資料庫, 名稱為north2, 其內容可由「網站樣版.zip」中<資料庫>內的north2.sql建立.      
```


###檔案放置方式:
```
下載網站樣版.zip, 並將以下解壓縮後的資料夾加入<web>網站的<public>內: 
  
 <web>
   |___<public>
          |___<css>
          |___<fonts>
          |___<image>
          |___<js>
          |___<picture>   
```



###增加/修改部份檔案:
```
 <web>
   |___app.js (修改)
   |
   |___<routes>
   |      |___productList.js (增加)
   |      |___<lib>
   |            |___db.js (增加)
   |
   |___<views>
   |      |___productList.ejs (增加)
   |
   |___<public>
          |___<css>
          |___<fonts>
          |___<image>
          |___<js>
          |___<picture>   
```



#####檔案名稱: app.js
```js
var express = require('express');
var path = require('path');
var favicon = require('serve-favicon');
var logger = require('morgan');
var cookieParser = require('cookie-parser');
var bodyParser = require('body-parser');

var index = require('./routes/index');
var users = require('./routes/users');

//-------------------------------------------------------
// 增加以下的require
//-------------------------------------------------------
var productList = require('./routes/productList');
//-------------------------------------------------------

var app = express();

app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'ejs');

app.use(logger('dev'));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));

app.use('/', index);
app.use('/users', users);

//-------------------------------------------------------
// 增加以下的app.use()
//-------------------------------------------------------
app.use('/productList', productList);
//-------------------------------------------------------

// catch 404 and forward to error handler
app.use(function(req, res, next) {
    var err = new Error('Not Found');
    err.status = 404;
    next(err);
});

// error handler
app.use(function(err, req, res, next) {
    // set locals, only providing error in development
    res.locals.message = err.message;
    res.locals.error = req.app.get('env') === 'development' ? err : {};

    // render the error page
    res.status(err.status || 500);
    res.render('error');
});

module.exports = app;

```


#####檔案名稱: db.js
```js
var mysql = require('mysql');

//------------------------
// 建立資料庫連線池
//------------------------
var pool  = mysql.createPool({
    user: 'root',
    password: 'mysql',
    host: '127.0.0.1',
    database: 'north2', 
    waitForConnections : true, 
    connectionLimit : 10       
});

//----------------------------
// 引用此模組時將匯出pool物件
//----------------------------
module.exports = pool;
```



#####檔案名稱: productList.js
```js
var express = require('express');
var router = express.Router();
//----------------------------------------------------
// 透過require引用db.js的pool物件,
// 即使多個程式均引用, 在系統中只有一份pool物件.
//----------------------------------------------------
var pool = require('./lib/db.js');


/* GET home page. */
router.get('/', function(req, res, next) {
    pool.query('select * from product', function (error, results, fields) {
        if (error){
            res.render('productList', {data:[]});
        }else{
            res.render('productList', {data:results});
        }       
    });
});

module.exports = router;
```



#####檔案名稱: productList.ejs
```js
<!DOCTYPE html>

<!--********************-->
<!-- 網頁開始           -->
<!--********************-->
<html lang="en">

<!--=====================-->
<!-- 標題開始            -->
<!--=====================-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>網頁練習</title>

<meta name="description" content="Source code generated using layoutit.com">
<meta name="author" content="LayoutIt!">

<!-- 引用資源 -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
</head>  
<!--=====================-->
<!-- 標題列結束          -->
<!--=====================--> 



<!--=====================-->
<!-- 內容開始            -->
<!--=====================-->
<body>
    <div class="container">
        <!------------------------------>
        <!-- 導覽列開始               -->
        <!------------------------------>
        <div class="row navbar">            	
            <div class="col-md-12">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <img src="image/icon48.jpg" class="circle"/>
                    </li>
						
                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">基本資料處理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">客戶資料清單</a>
                            </li>
                            <li>
                                <a href="#">客戶資料新增</a>
                            </li>

                            <li class="divider" />
                            
                            <li>
                                <a href="#">產品資料清單</a>
                            </li>  
                            <li>
                                <a href="#">產品資料新增</a>
                            </li>                                                                                        
                        </ul>
                    </li>

                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">交易處理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">進貨</a>
                            </li>
                            <li>
                                <a href="#">退貨</a>
                            </li>
                            
                            <li class="divider" />           
                                          
                            <li>
                                <a href="#">付款</a>
                            </li>
                            <li>
                                <a href="#">退款</a>
                            </li>                                                               
                        </ul>
                    </li>
                                                
                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">報表<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">客戶資料表</a>
                            </li>
                            <li>
                                <a href="#">產品資料表</a>
                            </li>
                        </ul>
                    </li>
                                                
                    <li class="dropdown pull-right">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">使用者<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">登入</a>
                            </li>
                            <li>
                                <a href="#">登出</a>
                            </li>
                            
                            <li class="divider" />     
                            
                            <li>
                                <a href="#">回首頁</a>
                            </li>                            
                        </ul>
                    </li>
                        
                    <li class="pull-right">
                        <span class="username">王小明</span>
                    </li>                         
                </ul>
            </div>
        </div>
        <!------------------------------>
        <!-- 導覽列結束               -->
        <!------------------------------>		
        
      
        <!------------------------------>
        <!-- 大標題開始               -->
        <!------------------------------>  
        <div class="row">
            <div class="col-md-12">              
                <div class="jumbotron">
                    <h2>
                        產品清單
                    </h2>
            
                    <p>
                        This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.
                    </p>
			    </div>
            </div>    
        </div>        
        <!------------------------------>
        <!-- 大標題結束               -->
        <!------------------------------>                 
                
                
                
        <!------------------------------>
        <!-- 內文開始                 -->
        <!------------------------------>                 
    	<div class="row">
            <div class="col-md-12">
                <table class="table table-bordered productTable">
                    <thead>
                        <tr>
                            <th>
                                產品編號
                            </th>
                            <th>
                                產品名稱
                            </th>
                            <th>
                                單價
                            </th>
                            <th>
                                庫存量
                            </th>
                            <th>
                                訂貨數量
                            </th>                        
                        </tr>
                    </thead>
                    <tbody>
                        <!------------------------------>
                        <!-- 顯示資料內容開始         -->
                        <!------------------------------>   					
	                      <% for(var i=0; i<data.length; i++) {%>
                            <tr>
                                <td>
                                    <a href="/productOne?no=<%= data[i].proNo %>"><%= data[i].proNo %></a>
                                </td>
                                <td>
                                    <%= data[i].proName %></a>
                                </td>
                                <td>
                                    <%= data[i].price %></a>
                                </td>
                                <td>
                                    <%= data[i].stockAmt %></a>
                                </td>
                                <td>
                                    <%= data[i].orderAmt %></a>
                                </td>                        
                            </tr> 
                        <% } %> 
                        <!------------------------------>
                        <!-- 顯示資料內容結束         -->
                        <!------------------------------> 						
                    </tbody>
                </table>
            </div>
        </div>
        <!------------------------------>
        <!-- 內文結束                 -->
        <!------------------------------>         
    
    
    
        <!------------------------------>
        <!-- 表尾開始                 -->
        <!------------------------------>     
        <div class="row">
            <div class="col-md-12">
                <p class="footer">
                    國立臺北商業大學資訊管理系(科)<br/>
                    100台北市中正區濟南路一段321號.  (02)2322-2777
                </p>
            </div>
        </div>
        <!------------------------------>
        <!-- 表尾結束                 -->
        <!------------------------------>
                
	</div>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/scripts.js"></script>   
</body>
<!--=====================-->
<!-- 內容結束            -->
<!--=====================-->

</html>
<!--********************-->
<!-- 網頁結束           -->
<!--********************-->
```
